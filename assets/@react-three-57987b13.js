import{_ as fe}from"./@babel-98964cd2.js";import{r as u,R as L}from"./react-1d8b2501.js";import{L as nt,a as Mn,R as xn,U as Pn,B as Sn,M as Rn,C as zt,b as _n,O as ht,P as gt,S as Pt,c as rt,N as On,A as jn,V as U,d as Wt,e as An,W as Fn,f as Tn,g as kn,h as In,i as Dn,T as Bn,D as Ln,j as He,k as xe,Q as zn,l as Wn,m as Nn,n as Xe,E as yt,o as Hn,p as Gn,q as qn,r as bt}from"./three-7b814cf1.js";import{u as Vn}from"./react-use-measure-d29e657e.js";import{F as Un,u as Qn}from"./its-fine-1bc6d9bc.js";import{R as Xn,c as Pe}from"./react-reconciler-9b028127.js";import{c as Yn}from"./react-dom-229e39cc.js";import{c as Nt}from"./zustand-b2af9d58.js";import"./maath-e8ea5ad3.js";import{u as Jn,a as Kn}from"./@react-spring-2af1e42f.js";import{u as Zn}from"./@use-gesture-f69afd0b.js";import{m as Ht}from"./react-merge-refs-239dbb3c.js";import{L as $n,a as er,b as tr,c as nr,d as rr,G as Et,D as or,M as ot}from"./three-stdlib-8a997847.js";import{T as ir,p as sr}from"./troika-three-text-7ffaeeec.js";import{s as Gt,p as ar,c as lr}from"./suspend-react-00b64780.js";import{ColliderDesc as cr,ActiveEvents as Ge,RigidBodyDesc as ur,EventQueue as fr}from"./@dimforge-dee4de67.js";import{u as dr}from"./use-asset-dfdf606c.js";var qt={exports:{}},Vt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(M,C){var x=M.length;M.push(C);e:for(;0<x;){var O=x-1>>>1,j=M[O];if(0<s(j,C))M[O]=C,M[x]=j,x=O;else break e}}function n(M){return M.length===0?null:M[0]}function r(M){if(M.length===0)return null;var C=M[0],x=M.pop();if(x!==C){M[0]=x;e:for(var O=0,j=M.length,z=j>>>1;O<z;){var D=2*(O+1)-1,Q=M[D],q=D+1,Z=M[q];if(0>s(Q,x))q<j&&0>s(Z,Q)?(M[O]=Z,M[q]=x,O=q):(M[O]=Q,M[D]=x,O=D);else if(q<j&&0>s(Z,x))M[O]=Z,M[q]=x,O=q;else break e}}return C}function s(M,C){var x=M.sortIndex-C.sortIndex;return x!==0?x:M.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var h=Date,f=h.now();e.unstable_now=function(){return h.now()-f}}var l=[],g=[],i=1,o=null,d=3,m=!1,v=!1,E=!1,y=typeof setTimeout=="function"?setTimeout:null,c=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(M){for(var C=n(g);C!==null;){if(C.callback===null)r(g);else if(C.startTime<=M)r(g),C.sortIndex=C.expirationTime,t(l,C);else break;C=n(g)}}function S(M){if(E=!1,b(M),!v)if(n(l)!==null)v=!0,R(_);else{var C=n(g);C!==null&&I(S,C.startTime-M)}}function _(M,C){v=!1,E&&(E=!1,c(B),B=-1),m=!0;var x=d;try{for(b(C),o=n(l);o!==null&&(!(o.expirationTime>C)||M&&!w());){var O=o.callback;if(typeof O=="function"){o.callback=null,d=o.priorityLevel;var j=O(o.expirationTime<=C);C=e.unstable_now(),typeof j=="function"?o.callback=j:o===n(l)&&r(l),b(C)}else r(l);o=n(l)}if(o!==null)var z=!0;else{var D=n(g);D!==null&&I(S,D.startTime-C),z=!1}return z}finally{o=null,d=x,m=!1}}var P=!1,F=null,B=-1,k=5,A=-1;function w(){return!(e.unstable_now()-A<k)}function T(){if(F!==null){var M=e.unstable_now();A=M;var C=!0;try{C=F(!0,M)}finally{C?H():(P=!1,F=null)}}else P=!1}var H;if(typeof p=="function")H=function(){p(T)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,G=K.port2;K.port1.onmessage=T,H=function(){G.postMessage(null)}}else H=function(){y(T,0)};function R(M){F=M,P||(P=!0,H())}function I(M,C){B=y(function(){M(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(M){M.callback=null},e.unstable_continueExecution=function(){v||m||(v=!0,R(_))},e.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<M?Math.floor(1e3/M):5},e.unstable_getCurrentPriorityLevel=function(){return d},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(M){switch(d){case 1:case 2:case 3:var C=3;break;default:C=d}var x=d;d=C;try{return M()}finally{d=x}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(M,C){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var x=d;d=M;try{return C()}finally{d=x}},e.unstable_scheduleCallback=function(M,C,x){var O=e.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?O+x:O):x=O,M){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=x+j,M={id:i++,callback:C,priorityLevel:M,startTime:x,expirationTime:j,sortIndex:-1},x>O?(M.sortIndex=x,t(g,M),n(l)===null&&M===n(g)&&(E?(c(B),B=-1):E=!0,I(S,x-O))):(M.sortIndex=j,t(l,M),v||m||(v=!0,R(_))),M},e.unstable_shouldYield=w,e.unstable_wrapCallback=function(M){var C=d;return function(){var x=d;d=C;try{return M.apply(this,arguments)}finally{d=x}}}})(Vt);qt.exports=Vt;var St=qt.exports;const wt={},pr=e=>void Object.assign(wt,e);function mr(e,t){function n(i,{args:o=[],attach:d,...m},v){let E=`${i[0].toUpperCase()}${i.slice(1)}`,y;if(i==="primitive"){if(m.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const c=m.object;y=Ce(c,{type:i,root:v,attach:d,primitive:!0})}else{const c=wt[E];if(!c)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=Ce(new c(...o),{type:i,root:v,attach:d,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof Sn?y.__r3f.attach="geometry":y instanceof Rn&&(y.__r3f.attach="material")),E!=="inject"&&at(y,m),y}function r(i,o){let d=!1;if(o){var m,v;(m=o.__r3f)!=null&&m.attach?st(i,o,o.__r3f.attach):o.isObject3D&&i.isObject3D&&(i.add(o),d=!0),d||(v=i.__r3f)==null||v.objects.push(o),o.__r3f||Ce(o,{}),o.__r3f.parent=i,mt(o),Me(o)}}function s(i,o,d){let m=!1;if(o){var v,E;if((v=o.__r3f)!=null&&v.attach)st(i,o,o.__r3f.attach);else if(o.isObject3D&&i.isObject3D){o.parent=i,o.dispatchEvent({type:"added"});const y=i.children.filter(p=>p!==o),c=y.indexOf(d);i.children=[...y.slice(0,c),o,...y.slice(c)],m=!0}m||(E=i.__r3f)==null||E.objects.push(o),o.__r3f||Ce(o,{}),o.__r3f.parent=i,mt(o),Me(o)}}function a(i,o,d=!1){i&&[...i].forEach(m=>h(o,m,d))}function h(i,o,d){if(o){var m,v,E;if(o.__r3f&&(o.__r3f.parent=null),(m=i.__r3f)!=null&&m.objects&&(i.__r3f.objects=i.__r3f.objects.filter(S=>S!==o)),(v=o.__r3f)!=null&&v.attach)At(i,o,o.__r3f.attach);else if(o.isObject3D&&i.isObject3D){var y;i.remove(o),(y=o.__r3f)!=null&&y.root&&Cr(o.__r3f.root,o)}const p=(E=o.__r3f)==null?void 0:E.primitive,b=d===void 0?o.dispose!==null&&!p:d;if(!p){var c;a((c=o.__r3f)==null?void 0:c.objects,o,b),a(o.children,o,b)}o.__r3f&&(delete o.__r3f.root,delete o.__r3f.objects,delete o.__r3f.handlers,delete o.__r3f.memoizedProps,p||delete o.__r3f),b&&o.dispose&&o.type!=="Scene"&&St.unstable_scheduleCallback(St.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),Me(i)}}function f(i,o,d,m){var v;const E=(v=i.__r3f)==null?void 0:v.parent;if(!E)return;const y=n(o,d,i.__r3f.root);if(i.children){for(const c of i.children)c.__r3f&&r(y,c);i.children=i.children.filter(c=>!c.__r3f)}i.__r3f.objects.forEach(c=>r(y,c)),i.__r3f.objects=[],i.__r3f.autoRemovedBeforeAppend||h(E,i),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),r(E,y),y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[m,m.alternate].forEach(c=>{c!==null&&(c.stateNode=y,c.ref&&(typeof c.ref=="function"?c.ref(y):c.ref.current=y))})}const l=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Xn({createInstance:n,removeChild:h,appendChild:r,appendInitialChild:r,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(i,o)=>{if(!o)return;const d=i.getState().scene;d.__r3f&&(d.__r3f.root=i,r(d,o))},removeChildFromContainer:(i,o)=>{o&&h(i.getState().scene,o)},insertInContainerBefore:(i,o,d)=>{if(!o||!d)return;const m=i.getState().scene;m.__r3f&&s(m,o,d)},getRootHostContext:()=>null,getChildHostContext:i=>i,finalizeInitialChildren(i){var o;return!!((o=i==null?void 0:i.__r3f)!=null?o:{}).handlers},prepareUpdate(i,o,d,m){if(i.__r3f.primitive&&m.object&&m.object!==i)return[!0];{const{args:v=[],children:E,...y}=m,{args:c=[],children:p,...b}=d;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((_,P)=>_!==c[P]))return[!0];const S=Zt(i,y,b,!0);return S.changes.length?[!1,S]:null}},commitUpdate(i,[o,d],m,v,E,y){o?f(i,m,E,y):at(i,d)},commitMount(i,o,d,m){var v;const E=(v=i.__r3f)!=null?v:{};i.raycast&&E.handlers&&E.eventCount&&i.__r3f.root.getState().internal.interaction.push(i)},getPublicInstance:i=>i,prepareForCommit:()=>null,preparePortalMount:i=>Ce(i.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(i){var o;const{attach:d,parent:m}=(o=i.__r3f)!=null?o:{};d&&m&&At(m,i,d),i.isObject3D&&(i.visible=!1),Me(i)},unhideInstance(i,o){var d;const{attach:m,parent:v}=(d=i.__r3f)!=null?d:{};m&&v&&st(v,i,m),(i.isObject3D&&o.visible==null||o.visible)&&(i.visible=!0),Me(i)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>t?t():Pe.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&V.fun(performance.now)?performance.now:V.fun(Date.now)?Date.now:()=>0,scheduleTimeout:V.fun(setTimeout)?setTimeout:void 0,cancelTimeout:V.fun(clearTimeout)?clearTimeout:void 0}),applyProps:at}}var Rt,_t;const it=e=>"colorSpace"in e||"outputColorSpace"in e,Ut=()=>{var e;return(e=wt.ColorManagement)!=null?e:null},Qt=e=>e&&e.isOrthographicCamera,vr=e=>e&&e.hasOwnProperty("current"),ke=typeof window<"u"&&((Rt=window.document)!=null&&Rt.createElement||((_t=window.navigator)==null?void 0:_t.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function Xt(e){const t=u.useRef(e);return ke(()=>void(t.current=e),[e]),t}function hr({set:e}){return ke(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class Yt extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}Yt.getDerivedStateFromError=()=>({error:!0});const Jt="__default",Ot=new Map,gr=e=>e&&!!e.memoized&&!!e.changes;function Kt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const Ae=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},V={obj:e=>e===Object(e)&&!V.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(V.str(e)||V.num(e))return e===t;const a=V.obj(e);if(a&&r==="reference")return e===t;const h=V.arr(e);if(h&&n==="reference")return e===t;if((h||a)&&e===t)return!0;let f;for(f in e)if(!(f in t))return!1;if(a&&n==="shallow"&&r==="shallow"){for(f in s?t:e)if(!V.equ(e[f],t[f],{strict:s,objects:"reference"}))return!1}else for(f in s?t:e)if(e[f]!==t[f])return!1;if(V.und(f)){if(h&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function yr(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function br(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function Ce(e,t){const n=e;return(t!=null&&t.primitive||!n.__r3f)&&(n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t}),e}function pt(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),s=r.pop();return n=r.reduce((a,h)=>a[h],e),{target:n,key:s}}else return{target:n,key:t}}const jt=/-\d+$/;function st(e,t,n){if(V.str(n)){if(jt.test(n)){const a=n.replace(jt,""),{target:h,key:f}=pt(e,a);Array.isArray(h[f])||(h[f]=[])}const{target:r,key:s}=pt(e,n);t.__r3f.previousAttach=r[s],r[s]=t}else t.__r3f.previousAttach=n(e,t)}function At(e,t,n){var r,s;if(V.str(n)){const{target:a,key:h}=pt(e,n),f=t.__r3f.previousAttach;f===void 0?delete a[h]:a[h]=f}else(r=t.__r3f)==null||r.previousAttach==null||r.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function Zt(e,{children:t,key:n,ref:r,...s},{children:a,key:h,ref:f,...l}={},g=!1){var i;const o=(i=e==null?void 0:e.__r3f)!=null?i:{},d=Object.entries(s),m=[];if(g){const E=Object.keys(l);for(let y=0;y<E.length;y++)s.hasOwnProperty(E[y])||d.unshift([E[y],Jt+"remove"])}d.forEach(([E,y])=>{var c;if((c=e.__r3f)!=null&&c.primitive&&E==="object"||V.equ(y,l[E]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(E))return m.push([E,y,!0,[]]);let p=[];E.includes("-")&&(p=E.split("-")),m.push([E,y,!1,p]);for(const b in s){const S=s[b];b.startsWith(`${E}-`)&&m.push([b,S,!1,b.split("-")])}});const v={...s};return o.memoizedProps&&o.memoizedProps.args&&(v.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(v.attach=o.memoizedProps.attach),{memoized:v,changes:m}}function at(e,t){var n,r,s;const a=(n=e.__r3f)!=null?n:{},h=a.root,f=(r=h==null||h.getState==null?void 0:h.getState())!=null?r:{},{memoized:l,changes:g}=gr(t)?t:Zt(e,t),i=a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=l);for(let d=0;d<g.length;d++){let[m,v,E,y]=g[d];if(it(e)){const S="srgb",_="srgb-linear";m==="encoding"?(m="colorSpace",v=v===3001?S:_):m==="outputEncoding"&&(m="outputColorSpace",v=v===3001?S:_)}let c=e,p=c[m];if(y.length&&(p=y.reduce((b,S)=>b[S],e),!(p&&p.set))){const[b,...S]=y.reverse();c=S.reverse().reduce((_,P)=>_[P],e),m=b}if(v===Jt+"remove")if(c.constructor){let b=Ot.get(c.constructor);b||(b=new c.constructor,Ot.set(c.constructor,b)),v=b[m]}else v=0;if(E)v?a.handlers[m]=v:delete a.handlers[m],a.eventCount=Object.keys(a.handlers).length;else if(p&&p.set&&(p.copy||p instanceof nt)){if(Array.isArray(v))p.fromArray?p.fromArray(v):p.set(...v);else if(p.copy&&v&&v.constructor&&p.constructor===v.constructor)p.copy(v);else if(v!==void 0){const b=p instanceof zt;!b&&p.setScalar?p.setScalar(v):p instanceof nt&&v instanceof nt?p.mask=v.mask:p.set(v),!Ut()&&!f.linear&&b&&p.convertSRGBToLinear()}}else if(c[m]=v,c[m]instanceof Mn&&c[m].format===xn&&c[m].type===Pn){const b=c[m];it(b)&&it(f.gl)?b.colorSpace=f.gl.outputColorSpace:b.encoding=f.gl.outputEncoding}Me(e)}if(a.parent&&f.internal&&e.raycast&&i!==a.eventCount){const d=f.internal.interaction.indexOf(e);d>-1&&f.internal.interaction.splice(d,1),a.eventCount&&f.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(s=e.__r3f)!=null&&s.parent&&mt(e),e}function Me(e){var t,n;const r=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();r&&r.internal.frames===0&&r.invalidate()}function mt(e){e.onUpdate==null||e.onUpdate(e)}function Er(e,t){e.manual||(Qt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function qe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function wr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return Pe.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return Pe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return Pe.ContinuousEventPriority;default:return Pe.DefaultEventPriority}}function $t(e,t,n,r){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(r),s.target.releasePointerCapture(r)))}function Cr(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(r=>r!==t),n.initialHits=n.initialHits.filter(r=>r!==t),n.hovered.forEach((r,s)=>{(r.eventObject===t||r.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((r,s)=>{$t(n.capturedMap,t,r,s)})}function Mr(e){function t(l){const{internal:g}=e.getState(),i=l.offsetX-g.initialClick[0],o=l.offsetY-g.initialClick[1];return Math.round(Math.sqrt(i*i+o*o))}function n(l){return l.filter(g=>["Move","Over","Enter","Out","Leave"].some(i=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+i]}))}function r(l,g){const i=e.getState(),o=new Set,d=[],m=g?g(i.internal.interaction):i.internal.interaction;for(let c=0;c<m.length;c++){const p=Ae(m[c]);p&&(p.raycaster.camera=void 0)}i.previousRoot||i.events.compute==null||i.events.compute(l,i);function v(c){const p=Ae(c);if(!p||!p.events.enabled||p.raycaster.camera===null)return[];if(p.raycaster.camera===void 0){var b;p.events.compute==null||p.events.compute(l,p,(b=p.previousRoot)==null?void 0:b.getState()),p.raycaster.camera===void 0&&(p.raycaster.camera=null)}return p.raycaster.camera?p.raycaster.intersectObject(c,!0):[]}let E=m.flatMap(v).sort((c,p)=>{const b=Ae(c.object),S=Ae(p.object);return!b||!S?c.distance-p.distance:S.events.priority-b.events.priority||c.distance-p.distance}).filter(c=>{const p=qe(c);return o.has(p)?!1:(o.add(p),!0)});i.events.filter&&(E=i.events.filter(E,i));for(const c of E){let p=c.object;for(;p;){var y;(y=p.__r3f)!=null&&y.eventCount&&d.push({...c,eventObject:p}),p=p.parent}}if("pointerId"in l&&i.internal.capturedMap.has(l.pointerId))for(let c of i.internal.capturedMap.get(l.pointerId).values())o.has(qe(c.intersection))||d.push(c.intersection);return d}function s(l,g,i,o){const d=e.getState();if(l.length){const m={stopped:!1};for(const v of l){const E=Ae(v.object)||d,{raycaster:y,pointer:c,camera:p,internal:b}=E,S=new U(c.x,c.y,0).unproject(p),_=A=>{var w,T;return(w=(T=b.capturedMap.get(A))==null?void 0:T.has(v.eventObject))!=null?w:!1},P=A=>{const w={intersection:v,target:g.target};b.capturedMap.has(A)?b.capturedMap.get(A).set(v.eventObject,w):b.capturedMap.set(A,new Map([[v.eventObject,w]])),g.target.setPointerCapture(A)},F=A=>{const w=b.capturedMap.get(A);w&&$t(b.capturedMap,v.eventObject,w,A)};let B={};for(let A in g){let w=g[A];typeof w!="function"&&(B[A]=w)}let k={...v,...B,pointer:c,intersections:l,stopped:m.stopped,delta:i,unprojectedPoint:S,ray:y.ray,camera:p,stopPropagation(){const A="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!A||A.has(v.eventObject))&&(k.stopped=m.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(w=>w.eventObject===v.eventObject))){const w=l.slice(0,l.indexOf(v));a([...w,v])}},target:{hasPointerCapture:_,setPointerCapture:P,releasePointerCapture:F},currentTarget:{hasPointerCapture:_,setPointerCapture:P,releasePointerCapture:F},nativeEvent:g};if(o(k),m.stopped===!0)break}}return l}function a(l){const{internal:g}=e.getState();for(const i of g.hovered.values())if(!l.length||!l.find(o=>o.object===i.object&&o.index===i.index&&o.instanceId===i.instanceId)){const d=i.eventObject.__r3f,m=d==null?void 0:d.handlers;if(g.hovered.delete(qe(i)),d!=null&&d.eventCount){const v={...i,intersections:l};m.onPointerOut==null||m.onPointerOut(v),m.onPointerLeave==null||m.onPointerLeave(v)}}}function h(l,g){for(let i=0;i<g.length;i++){const o=g[i].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(l)}}function f(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return g=>{const{internal:i}=e.getState();"pointerId"in g&&i.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{i.capturedMap.has(g.pointerId)&&(i.capturedMap.delete(g.pointerId),a([]))})}}return function(i){const{onPointerMissed:o,internal:d}=e.getState();d.lastEvent.current=i;const m=l==="onPointerMove",v=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",y=r(i,m?n:void 0),c=v?t(i):0;l==="onPointerDown"&&(d.initialClick=[i.offsetX,i.offsetY],d.initialHits=y.map(b=>b.eventObject)),v&&!y.length&&c<=2&&(h(i,d.interaction),o&&o(i)),m&&a(y);function p(b){const S=b.eventObject,_=S.__r3f,P=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(m){if(P.onPointerOver||P.onPointerEnter||P.onPointerOut||P.onPointerLeave){const F=qe(b),B=d.hovered.get(F);B?B.stopped&&b.stopPropagation():(d.hovered.set(F,b),P.onPointerOver==null||P.onPointerOver(b),P.onPointerEnter==null||P.onPointerEnter(b))}P.onPointerMove==null||P.onPointerMove(b)}else{const F=P[l];F?(!v||d.initialHits.includes(S))&&(h(i,d.interaction.filter(B=>!d.initialHits.includes(B))),F(b)):v&&d.initialHits.includes(S)&&h(i,d.interaction.filter(B=>!d.initialHits.includes(B)))}}s(y,i,c,p)}}return{handlePointer:f}}const en=e=>!!(e!=null&&e.render),tn=u.createContext(null),xr=(e,t)=>{const n=Nt((f,l)=>{const g=new U,i=new U,o=new U;function d(c=l().camera,p=i,b=l().size){const{width:S,height:_,top:P,left:F}=b,B=S/_;p instanceof U?o.copy(p):o.set(...p);const k=c.getWorldPosition(g).distanceTo(o);if(Qt(c))return{width:S/c.zoom,height:_/c.zoom,top:P,left:F,factor:1,distance:k,aspect:B};{const A=c.fov*Math.PI/180,w=2*Math.tan(A/2)*k,T=w*(S/_);return{width:T,height:w,top:P,left:F,factor:S/T,distance:k,aspect:B}}}let m;const v=c=>f(p=>({performance:{...p.performance,current:c}})),E=new Wt;return{set:f,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(c=1)=>e(l(),c),advance:(c,p)=>t(c,p,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new An,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const c=l();m&&clearTimeout(m),c.performance.current!==c.performance.min&&v(c.performance.min),m=setTimeout(()=>v(l().performance.max),c.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:d},setEvents:c=>f(p=>({...p,events:{...p.events,...c}})),setSize:(c,p,b,S,_)=>{const P=l().camera,F={width:c,height:p,top:S||0,left:_||0,updateStyle:b};f(B=>({size:F,viewport:{...B.viewport,...d(P,i,F)}}))},setDpr:c=>f(p=>{const b=Kt(c);return{viewport:{...p.viewport,dpr:b,initialDpr:p.viewport.initialDpr||b}}}),setFrameloop:(c="always")=>{const p=l().clock;p.stop(),p.elapsedTime=0,c!=="never"&&(p.start(),p.elapsedTime=0),f(()=>({frameloop:c}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(c,p,b)=>{const S=l().internal;return S.priority=S.priority+(p>0?1:0),S.subscribers.push({ref:c,priority:p,store:b}),S.subscribers=S.subscribers.sort((_,P)=>_.priority-P.priority),()=>{const _=l().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(p>0?1:0),_.subscribers=_.subscribers.filter(P=>P.ref!==c))}}}}}),r=n.getState();let s=r.size,a=r.viewport.dpr,h=r.camera;return n.subscribe(()=>{const{camera:f,size:l,viewport:g,gl:i,set:o}=n.getState();if(l!==s||g.dpr!==a){var d;s=l,a=g.dpr,Er(f,l),i.setPixelRatio(g.dpr);const m=(d=l.updateStyle)!=null?d:typeof HTMLCanvasElement<"u"&&i.domElement instanceof HTMLCanvasElement;i.setSize(l.width,l.height,m)}f!==h&&(h=f,o(m=>({viewport:{...m.viewport,...m.viewport.getCurrentViewport(f)}})))}),n.subscribe(f=>e(f)),n};function Pr(e,t){const n={callback:e};return t.add(n),()=>void t.delete(n)}let Ve,nn=new Set,Sr=new Set,Rr=new Set;const ii=e=>Pr(e,nn);function lt(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Fe(e,t){switch(e){case"before":return lt(nn,t);case"after":return lt(Sr,t);case"tail":return lt(Rr,t)}}let ct,ut;function ft(e,t,n){let r=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ct=t.internal.subscribers,Ve=0;Ve<ct.length;Ve++)ut=ct[Ve],ut.ref.current(ut.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function _r(e){let t=!1,n,r,s;function a(l){r=requestAnimationFrame(a),t=!0,n=0,Fe("before",l);for(const i of e.values()){var g;s=i.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((g=s.gl.xr)!=null&&g.isPresenting)&&(n+=ft(l,s))}if(Fe("after",l),n===0)return Fe("tail",l),t=!1,cancelAnimationFrame(r)}function h(l,g=1){var i;if(!l)return e.forEach(o=>h(o.store.getState()),g);(i=l.gl.xr)!=null&&i.isPresenting||!l.internal.active||l.frameloop==="never"||(l.internal.frames=Math.min(60,l.internal.frames+g),t||(t=!0,requestAnimationFrame(a)))}function f(l,g=!0,i,o){if(g&&Fe("before",l),i)ft(l,i,o);else for(const d of e.values())ft(l,d.store.getState());g&&Fe("after",l)}return{loop:a,invalidate:h,advance:f}}function rn(){const e=u.useContext(tn);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function se(e=n=>n,t){return rn()(e,t)}function Je(e,t=0){const n=rn(),r=n.getState().internal.subscribe,s=Xt(e);return ke(()=>r(s,t,n),[t,r,n]),null}function on(e,t){return function(n,...r){const s=new n;return e&&e(s),Promise.all(r.map(a=>new Promise((h,f)=>s.load(a,l=>{l.scene&&Object.assign(l,yr(l.scene)),h(l)},t,l=>f(new Error(`Could not load ${a}: ${l.message})`))))))}}function Ie(e,t,n,r){const s=Array.isArray(t)?t:[t],a=Gt(on(n,r),[e,...s],{equal:V.equ});return Array.isArray(t)?a:a[0]}Ie.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return ar(on(n),[e,...r])};Ie.clear=function(e,t){const n=Array.isArray(t)?t:[t];return lr([e,...n])};const Se=new Map,{invalidate:Ft,advance:Tt}=_r(Se),{reconciler:Ye,applyProps:Ee}=mr(Se,wr),we={objects:"shallow",strict:!1},Or=(e,t)=>{const n=typeof e=="function"?e(t):e;return en(n)?n:new Fn({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function jr(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:r,top:s,left:a}=e.parentElement.getBoundingClientRect();return{width:n,height:r,top:s,left:a}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function Ar(e){const t=Se.get(e),n=t==null?void 0:t.fiber,r=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,a=r||xr(Ft,Tt),h=n||Ye.createContainer(a,Pe.ConcurrentRoot,null,!1,null,"",s,null);t||Se.set(e,{fiber:h,store:a});let f,l=!1,g;return{configure(i={}){let{gl:o,size:d,scene:m,events:v,onCreated:E,shadows:y=!1,linear:c=!1,flat:p=!1,legacy:b=!1,orthographic:S=!1,frameloop:_="always",dpr:P=[1,2],performance:F,raycaster:B,camera:k,onPointerMissed:A}=i,w=a.getState(),T=w.gl;w.gl||w.set({gl:T=Or(o,e)});let H=w.raycaster;H||w.set({raycaster:H=new _n});const{params:K,...G}=B||{};if(V.equ(G,H,we)||Ee(H,{...G}),V.equ(K,H.params,we)||Ee(H,{params:{...H.params,...K}}),!w.camera||w.camera===g&&!V.equ(g,k,we)){g=k;const O=k instanceof Tn,j=O?k:S?new ht(0,0,0,0,.1,1e3):new gt(75,0,.1,1e3);O||(j.position.z=5,k&&Ee(j,k),!w.camera&&!(k!=null&&k.rotation)&&j.lookAt(0,0,0)),w.set({camera:j})}if(!w.scene){let O;m instanceof Pt?O=m:(O=new Pt,m&&Ee(O,m)),w.set({scene:Ce(O)})}if(!w.xr){const O=(D,Q)=>{const q=a.getState();q.frameloop!=="never"&&Tt(D,!0,q,Q)},j=()=>{const D=a.getState();D.gl.xr.enabled=D.gl.xr.isPresenting,D.gl.xr.setAnimationLoop(D.gl.xr.isPresenting?O:null),D.gl.xr.isPresenting||Ft(D)},z={connect(){const D=a.getState().gl;D.xr.addEventListener("sessionstart",j),D.xr.addEventListener("sessionend",j)},disconnect(){const D=a.getState().gl;D.xr.removeEventListener("sessionstart",j),D.xr.removeEventListener("sessionend",j)}};T.xr&&z.connect(),w.set({xr:z})}if(T.shadowMap){const O=T.shadowMap.enabled,j=T.shadowMap.type;if(T.shadowMap.enabled=!!y,V.boo(y))T.shadowMap.type=rt;else if(V.str(y)){var R;const z={basic:kn,percentage:In,soft:rt,variance:Dn};T.shadowMap.type=(R=z[y])!=null?R:rt}else V.obj(y)&&Object.assign(T.shadowMap,y);(O!==T.shadowMap.enabled||j!==T.shadowMap.type)&&(T.shadowMap.needsUpdate=!0)}const I=Ut();I&&("enabled"in I?I.enabled=!b:"legacyMode"in I&&(I.legacyMode=b)),Ee(T,{outputEncoding:c?3e3:3001,toneMapping:p?On:jn}),w.legacy!==b&&w.set(()=>({legacy:b})),w.linear!==c&&w.set(()=>({linear:c})),w.flat!==p&&w.set(()=>({flat:p})),o&&!V.fun(o)&&!en(o)&&!V.equ(o,T,we)&&Ee(T,o),v&&!w.events.handlers&&w.set({events:v(a)});const x=jr(e,d);return V.equ(x,w.size,we)||w.setSize(x.width,x.height,x.updateStyle,x.top,x.left),P&&w.viewport.dpr!==Kt(P)&&w.setDpr(P),w.frameloop!==_&&w.setFrameloop(_),w.onPointerMissed||w.set({onPointerMissed:A}),F&&!V.equ(F,w.performance,we)&&w.set(O=>({performance:{...O.performance,...F}})),f=E,l=!0,this},render(i){return l||this.configure(),Ye.updateContainer(u.createElement(Fr,{store:a,children:i,onCreated:f,rootElement:e}),h,null,()=>{}),a},unmount(){sn(e)}}}function Fr({store:e,children:t,onCreated:n,rootElement:r}){return ke(()=>{const s=e.getState();s.set(a=>({internal:{...a.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(r)},[]),u.createElement(tn.Provider,{value:e},t)}function sn(e,t){const n=Se.get(e),r=n==null?void 0:n.fiber;if(r){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),Ye.updateContainer(null,r,null,()=>{s&&setTimeout(()=>{try{var a,h,f,l;s.events.disconnect==null||s.events.disconnect(),(a=s.gl)==null||(h=a.renderLists)==null||h.dispose==null||h.dispose(),(f=s.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(l=s.gl)!=null&&l.xr&&s.xr.disconnect(),br(s),Se.delete(e),t&&t(e)}catch{}},500)})}}Ye.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const dt={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Tr(e){const{handlePointer:t}=Mr(e);return{priority:1,enabled:!0,compute(n,r,s){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(dt).reduce((n,r)=>({...n,[r]:t(r)}),{}),update:()=>{var n;const{events:r,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var r;const{set:s,events:a}=e.getState();a.disconnect==null||a.disconnect(),s(h=>({events:{...h.events,connected:n}})),Object.entries((r=a.handlers)!=null?r:[]).forEach(([h,f])=>{const[l,g]=dt[h];n.addEventListener(l,f,{passive:g})})},disconnect:()=>{const{set:n,events:r}=e.getState();if(r.connected){var s;Object.entries((s=r.handlers)!=null?s:[]).forEach(([a,h])=>{if(r&&r.connected instanceof HTMLElement){const[f]=dt[a];r.connected.removeEventListener(f,h)}}),n(a=>({events:{...a.events,connected:void 0}}))}}}}const kr=u.forwardRef(function({children:t,fallback:n,resize:r,style:s,gl:a,events:h=Tr,eventSource:f,eventPrefix:l,shadows:g,linear:i,flat:o,legacy:d,orthographic:m,frameloop:v,dpr:E,performance:y,raycaster:c,camera:p,onPointerMissed:b,onCreated:S,..._},P){u.useMemo(()=>pr(Bn),[]);const F=Qn(),[B,k]=Vn({scroll:!0,debounce:{scroll:50,resize:0},...r}),A=u.useRef(null),w=u.useRef(null);u.useImperativeHandle(P,()=>A.current);const T=Xt(b),[H,K]=u.useState(!1),[G,R]=u.useState(!1);if(H)throw H;if(G)throw G;const I=u.useRef(null);ke(()=>{const C=A.current;k.width>0&&k.height>0&&C&&(I.current||(I.current=Ar(C)),I.current.configure({gl:a,events:h,shadows:g,linear:i,flat:o,legacy:d,orthographic:m,frameloop:v,dpr:E,performance:y,raycaster:c,camera:p,size:k,onPointerMissed:(...x)=>T.current==null?void 0:T.current(...x),onCreated:x=>{x.events.connect==null||x.events.connect(f?vr(f)?f.current:f:w.current),l&&x.setEvents({compute:(O,j)=>{const z=O[l+"X"],D=O[l+"Y"];j.pointer.set(z/j.size.width*2-1,-(D/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),S==null||S(x)}}),I.current.render(u.createElement(F,null,u.createElement(Yt,{set:R},u.createElement(u.Suspense,{fallback:u.createElement(hr,{set:K})},t)))))}),u.useEffect(()=>{const C=A.current;if(C)return()=>sn(C)},[]);const M=f?"none":"auto";return u.createElement("div",fe({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:M,...s}},_),u.createElement("div",{ref:B,style:{width:"100%",height:"100%"}},u.createElement("canvas",{ref:A,style:{display:"block"}},n)))}),si=u.forwardRef(function(t,n){return u.createElement(Un,null,u.createElement(kr,fe({},t,{ref:n})))}),De=new U,Ct=new U,Ir=new U;function Dr(e,t,n){const r=De.setFromMatrixPosition(e.matrixWorld);r.project(t);const s=n.width/2,a=n.height/2;return[r.x*s+s,-(r.y*a)+a]}function Br(e,t){const n=De.setFromMatrixPosition(e.matrixWorld),r=Ct.setFromMatrixPosition(t.matrixWorld),s=n.sub(r),a=t.getWorldDirection(Ir);return s.angleTo(a)>Math.PI/2}function Lr(e,t,n,r){const s=De.setFromMatrixPosition(e.matrixWorld),a=s.clone();a.project(t),n.setFromCamera(a,t);const h=n.intersectObjects(r,!0);if(h.length){const f=h[0].distance;return s.distanceTo(n.ray.origin)<f}return!0}function zr(e,t){if(t instanceof ht)return t.zoom;if(t instanceof gt){const n=De.setFromMatrixPosition(e.matrixWorld),r=Ct.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,a=n.distanceTo(r);return 1/(2*Math.tan(s/2)*a)}else return 1}function Wr(e,t,n){if(t instanceof gt||t instanceof ht){const r=De.setFromMatrixPosition(e.matrixWorld),s=Ct.setFromMatrixPosition(t.matrixWorld),a=r.distanceTo(s),h=(n[1]-n[0])/(t.far-t.near),f=n[1]-h*t.far;return Math.round(h*a+f)}}const vt=e=>Math.abs(e)<1e-10?0:e;function an(e,t,n=""){let r="matrix3d(";for(let s=0;s!==16;s++)r+=vt(t[s]*e.elements[s])+(s!==15?",":")");return n+r}const Nr=(e=>t=>an(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Hr=(e=>(t,n)=>an(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Gr(e){return e&&typeof e=="object"&&"current"in e}const ai=u.forwardRef(({children:e,eps:t=.001,style:n,className:r,prepend:s,center:a,fullscreen:h,portal:f,distanceFactor:l,sprite:g=!1,transform:i=!1,occlude:o,onOcclude:d,castShadow:m,receiveShadow:v,material:E,geometry:y,zIndexRange:c=[16777271,0],calculatePosition:p=Dr,as:b="div",wrapperClass:S,pointerEvents:_="auto",...P},F)=>{const{gl:B,camera:k,scene:A,size:w,raycaster:T,events:H,viewport:K}=se(),[G]=u.useState(()=>document.createElement(b)),R=u.useRef(),I=u.useRef(null),M=u.useRef(0),C=u.useRef([0,0]),x=u.useRef(null),O=u.useRef(null),j=(f==null?void 0:f.current)||H.connected||B.domElement.parentNode,z=u.useRef(null),D=u.useRef(!1),Q=u.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Gr(o[0]),[o]);u.useLayoutEffect(()=>{const X=B.domElement;o&&o==="blending"?(X.style.zIndex=`${Math.floor(c[0]/2)}`,X.style.position="absolute",X.style.pointerEvents="none"):(X.style.zIndex=null,X.style.position=null,X.style.pointerEvents=null)},[o]),u.useLayoutEffect(()=>{if(I.current){const X=R.current=Yn(G);if(A.updateMatrixWorld(),i)G.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const W=p(I.current,k,w);G.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${W[0]}px,${W[1]}px,0);transform-origin:0 0;`}return j&&(s?j.prepend(G):j.appendChild(G)),()=>{j&&j.removeChild(G),X.unmount()}}},[j,i]),u.useLayoutEffect(()=>{S&&(G.className=S)},[S]);const q=u.useMemo(()=>i?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...n},[n,a,h,w,i]),Z=u.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);u.useLayoutEffect(()=>{if(D.current=!1,i){var X;(X=R.current)==null||X.render(u.createElement("div",{ref:x,style:q},u.createElement("div",{ref:O,style:Z},u.createElement("div",{ref:F,className:r,style:n,children:e}))))}else{var W;(W=R.current)==null||W.render(u.createElement("div",{ref:F,style:q,className:r,children:e}))}});const ee=u.useRef(!0);Je(X=>{if(I.current){k.updateMatrixWorld(),I.current.updateWorldMatrix(!0,!1);const W=i?C.current:p(I.current,k,w);if(i||Math.abs(M.current-k.zoom)>t||Math.abs(C.current[0]-W[0])>t||Math.abs(C.current[1]-W[1])>t){const oe=Br(I.current,k);let $=!1;Q&&(o!=="blending"?$=[A]:Array.isArray(o)&&($=o.map(te=>te.current)));const ae=ee.current;if($){const te=Lr(I.current,k,T,$);ee.current=te&&!oe}else ee.current=!oe;ae!==ee.current&&(d?d(!ee.current):G.style.display=ee.current?"block":"none");const le=Math.floor(c[0]/2),Re=o?Q?[c[0],le]:[le-1,0]:c;if(G.style.zIndex=`${Wr(I.current,k,Re)}`,i){const[te,ve]=[w.width/2,w.height/2],ce=k.projectionMatrix.elements[5]*ve,{isOrthographicCamera:he,top:ge,left:_e,bottom:ye,right:Oe}=k,be=Nr(k.matrixWorldInverse),je=he?`scale(${ce})translate(${vt(-(Oe+_e)/2)}px,${vt((ge+ye)/2)}px)`:`translateZ(${ce}px)`;let ne=I.current.matrixWorld;g&&(ne=k.matrixWorldInverse.clone().transpose().copyPosition(ne).scale(I.current.scale),ne.elements[3]=ne.elements[7]=ne.elements[11]=0,ne.elements[15]=1),G.style.width=w.width+"px",G.style.height=w.height+"px",G.style.perspective=he?"":`${ce}px`,x.current&&O.current&&(x.current.style.transform=`${je}${be}translate(${te}px,${ve}px)`,O.current.style.transform=Hr(ne,1/((l||10)/400)))}else{const te=l===void 0?1:zr(I.current,k)*l;G.style.transform=`translate3d(${W[0]}px,${W[1]}px,0) scale(${te})`}C.current=W,M.current=k.zoom}}if(!Q&&z.current&&!D.current)if(i){if(x.current){const W=x.current.children[0];if(W!=null&&W.clientWidth&&W!=null&&W.clientHeight){const{isOrthographicCamera:oe}=k;if(oe||y)P.scale&&(Array.isArray(P.scale)?P.scale instanceof U?z.current.scale.copy(P.scale.clone().divideScalar(1)):z.current.scale.set(1/P.scale[0],1/P.scale[1],1/P.scale[2]):z.current.scale.setScalar(1/P.scale));else{const $=(l||10)/400,ae=W.clientWidth*$,le=W.clientHeight*$;z.current.scale.set(ae,le,1)}D.current=!0}}}else{const W=G.children[0];if(W!=null&&W.clientWidth&&W!=null&&W.clientHeight){const oe=1/K.factor,$=W.clientWidth*oe,ae=W.clientHeight*oe;z.current.scale.set($,ae,1),D.current=!0}z.current.lookAt(X.camera.position)}});const de=u.useMemo(()=>({vertexShader:i?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[i]);return u.createElement("group",fe({},P,{ref:I}),o&&!Q&&u.createElement("mesh",{castShadow:m,receiveShadow:v,ref:z},y||u.createElement("planeGeometry",null),E||u.createElement("shaderMaterial",{side:Ln,vertexShader:de.vertexShader,fragmentShader:de.fragmentShader})))});let Te=0;const li=Nt(e=>(He.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-Te)/(r-Te)*100})},He.onLoad=()=>{e({active:!1})},He.onError=t=>e(n=>({errors:[...n.errors,t]})),He.onProgress=(t,n,r)=>{n===r&&(Te=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-Te)/(r-Te)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function ci({enabled:e=!0,snap:t,global:n,domElement:r,cursor:s=!0,children:a,speed:h=1,rotation:f=[0,0,0],zoom:l=1,polar:g=[0,Math.PI/2],azimuth:i=[-1/0,1/0],config:o={mass:1,tension:170,friction:26}}){const d=se(P=>P.events),m=se(P=>P.gl),v=r||d.connected||m.domElement,{size:E}=se(),y=u.useMemo(()=>[f[0]+g[0],f[0]+g[1]],[f[0],g[0],g[1]]),c=u.useMemo(()=>[f[1]+i[0],f[1]+i[1]],[f[1],i[0],i[1]]),p=u.useMemo(()=>[xe.clamp(f[0],...y),xe.clamp(f[1],...c),f[2]],[f[0],f[1],f[2],y,c]),[b,S]=Jn(()=>({scale:1,rotation:p,config:o}));u.useEffect(()=>void S.start({scale:1,rotation:p,config:o}),[p]),u.useEffect(()=>(n&&s&&e&&(v.style.cursor="grab",m.domElement.style.cursor=""),()=>{v.style.cursor="default",m.domElement.style.cursor="default"}),[n,s,v,e]);const _=Zn({onHover:({last:P})=>{s&&!n&&e&&(v.style.cursor=P?"auto":"grab")},onDrag:({down:P,delta:[F,B],memo:[k,A]=b.rotation.animation.to||p})=>{if(!e)return[B,F];s&&(v.style.cursor=P?"grabbing":"grab"),F=xe.clamp(A+F/E.width*Math.PI*h,...c),B=xe.clamp(k+B/E.height*Math.PI*h,...y);const w=t&&!P&&typeof t!="boolean"?t:o;return S.start({scale:P&&B>y[1]/2?l:1,rotation:t&&!P?p:[B,F,0],config:T=>T==="scale"?{...w,friction:w.friction*3}:w}),[B,F]}},{target:n?v:void 0});return u.createElement(Kn.group,fe({},_==null?void 0:_(),b),a)}const qr=u.forwardRef(function({points:t,color:n="black",vertexColors:r,linewidth:s,lineWidth:a,segments:h,dashed:f,...l},g){const i=se(v=>v.size),o=u.useMemo(()=>h?new $n:new er,[h]),[d]=u.useState(()=>new tr),m=u.useMemo(()=>{const v=h?new nr:new rr,E=t.map(y=>{const c=Array.isArray(y);return y instanceof U?[y.x,y.y,y.z]:y instanceof Wt?[y.x,y.y,0]:c&&y.length===3?[y[0],y[1],y[2]]:c&&y.length===2?[y[0],y[1],0]:y});if(v.setPositions(E.flat()),r){const y=r.map(c=>c instanceof zt?c.toArray():c);v.setColors(y.flat())}return v},[t,h,r]);return u.useLayoutEffect(()=>{o.computeLineDistances()},[t,o]),u.useLayoutEffect(()=>{f?d.defines.USE_DASH="":delete d.defines.USE_DASH,d.needsUpdate=!0},[f,d]),u.useEffect(()=>()=>m.dispose(),[m]),u.createElement("primitive",fe({object:o,ref:g},l),u.createElement("primitive",{object:m,attach:"geometry"}),u.createElement("primitive",fe({object:d,attach:"material",color:n,vertexColors:!!r,resolution:[i.width,i.height],linewidth:s??a,dashed:f},l)))}),Vr=new U,ui=u.forwardRef(function({start:t=[0,0,0],end:n=[0,0,0],mid:r,segments:s=20,...a},h){const f=u.useRef(null),[l]=u.useState(()=>new zn(void 0,void 0,void 0)),g=u.useCallback((o,d,m,v=20)=>(o instanceof U?l.v0.copy(o):l.v0.set(...o),d instanceof U?l.v2.copy(d):l.v2.set(...d),m instanceof U?l.v1.copy(m):Array.isArray(m)?l.v1.set(...m):l.v1.copy(l.v0.clone().add(l.v2.clone().sub(l.v0)).add(Vr.set(0,l.v0.y-l.v2.y,0))),l.getPoints(v)),[]);u.useLayoutEffect(()=>{f.current.setPoints=(o,d,m)=>{const v=g(o,d,m);f.current.geometry&&f.current.geometry.setPositions(v.map(E=>E.toArray()).flat())}},[]);const i=u.useMemo(()=>g(t,n,r,s),[t,n,r,s]);return u.createElement(qr,fe({ref:Ht([f,h]),points:i},a))}),fi=u.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:n="middle",font:r,fontSize:s=1,children:a,characters:h,onSync:f,...l},g)=>{const i=se(({invalidate:v})=>v),[o]=u.useState(()=>new ir),[d,m]=u.useMemo(()=>{const v=[];let E="";return u.Children.forEach(a,y=>{typeof y=="string"||typeof y=="number"?E+=y:v.push(y)}),[v,E]},[a]);return Gt(()=>new Promise(v=>sr({font:r,characters:h},v)),["troika-text",r,h]),u.useLayoutEffect(()=>void o.sync(()=>{i(),f&&f(o)})),u.useEffect(()=>()=>o.dispose(),[o]),u.createElement("primitive",fe({object:o,ref:g,font:r,text:m,anchorX:t,anchorY:n,fontSize:s,sdfGlyphSize:e},l),d)});let Ue=null;function ln(e,t,n){return r=>{n&&n(r),e&&(Ue||(Ue=new or),Ue.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),r.setDRACOLoader(Ue)),t&&r.setMeshoptDecoder(typeof ot=="function"?ot():ot)}}function cn(e,t=!0,n=!0,r){return Ie(Et,e,ln(t,n,r))}cn.preload=(e,t=!0,n=!0,r)=>Ie.preload(Et,e,ln(t,n,r));cn.clear=e=>Ie.clear(Et,e);const di=u.forwardRef(({children:e,enabled:t=!0,speed:n=1,rotationIntensity:r=1,floatIntensity:s=1,floatingRange:a=[-.1,.1],...h},f)=>{const l=u.useRef(null),g=u.useRef(Math.random()*1e4);return Je(i=>{var o,d;if(!t||n===0)return;const m=g.current+i.clock.getElapsedTime();l.current.rotation.x=Math.cos(m/4*n)/8*r,l.current.rotation.y=Math.sin(m/4*n)/8*r,l.current.rotation.z=Math.sin(m/4*n)/20*r;let v=Math.sin(m/4*n)/10;v=xe.mapLinear(v,-.1,.1,(o=a==null?void 0:a[0])!==null&&o!==void 0?o:-.1,(d=a==null?void 0:a[1])!==null&&d!==void 0?d:.1),l.current.position.y=v*s,l.current.updateMatrix()}),u.createElement("group",h,u.createElement("group",{ref:Ht([l,f]),matrixAutoUpdate:!1},e))});function pi({all:e,scene:t,camera:n}){const r=se(({gl:h})=>h),s=se(({camera:h})=>h),a=se(({scene:h})=>h);return u.useLayoutEffect(()=>{const h=[];e&&(t||a).traverse(g=>{g.visible===!1&&(h.push(g),g.visible=!0)}),r.compile(t||a,n||s);const f=new Wn(128);new Nn(.01,1e5,f).update(r,t||a),f.dispose(),h.forEach(g=>g.visible=!1)},[]),null}const Ur="modulepreload",Qr=function(e){return"/react-Product/"+e},kt={},Xr=function(t,n,r){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(a=>{if(a=Qr(a),a in kt)return;kt[a]=!0;const h=a.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(!!r)for(let i=s.length-1;i>=0;i--){const o=s[i];if(o.href===a&&(!h||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${f}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":Ur,h||(g.as="script",g.crossOrigin=""),g.href=a,document.head.appendChild(g),h)return new Promise((i,o)=>{g.addEventListener("load",i),g.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())};function Yr(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},r=e.getIndex(),s=e.getAttribute("position"),a=r?r.count:s.count;let h=0;const f=Object.keys(e.attributes),l={},g={},i=[],o=["getX","getY","getZ","getW"];for(let E=0,y=f.length;E<y;E++){const c=f[E];l[c]=[];const p=e.morphAttributes[c];p&&(g[c]=new Array(p.length).fill(0).map(()=>[]))}const d=Math.log10(1/t),m=Math.pow(10,d);for(let E=0;E<a;E++){const y=r?r.getX(E):E;let c="";for(let p=0,b=f.length;p<b;p++){const S=f[p],_=e.getAttribute(S),P=_.itemSize;for(let F=0;F<P;F++)c+=`${~~(_[o[F]](y)*m)},`}if(c in n)i.push(n[c]);else{for(let p=0,b=f.length;p<b;p++){const S=f[p],_=e.getAttribute(S),P=e.morphAttributes[S],F=_.itemSize,B=l[S],k=g[S];for(let A=0;A<F;A++){const w=o[A];if(B.push(_[w](y)),P)for(let T=0,H=P.length;T<H;T++)k[T].push(P[T][w](y))}}n[c]=h,i.push(h),h++}}const v=e.clone();for(let E=0,y=f.length;E<y;E++){const c=f[E],p=e.getAttribute(c),b=new p.array.constructor(l[c]),S=new Xe(b,p.itemSize,p.normalized);if(v.setAttribute(c,S),c in g)for(let _=0;_<g[c].length;_++){const P=e.morphAttributes[c][_],F=new P.array.constructor(g[c][_]),B=new Xe(F,P.itemSize,P.normalized);v.morphAttributes[c][_]=B}}return v.setIndex(i),v}function Jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?It(Object(n),!0).forEach(function(r){Jr(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const Kr=e=>({raw:()=>e.current(),getCollider:t=>e.current().getCollider(t),getRigidBody:t=>e.current().getRigidBody(t),createRigidBody:t=>e.current().createRigidBody(t),createCollider:(t,n)=>e.current().createCollider(t,n),removeRigidBody:t=>{e.current().bodies.contains(t.handle)&&e.current().removeRigidBody(t)},removeCollider:(t,n=!0)=>{e.current().colliders.contains(t.handle)&&e.current().removeCollider(t,n)},createImpulseJoint:(t,n,r,s=!0)=>e.current().createImpulseJoint(t,n,r,s),removeImpulseJoint:(t,n=!0)=>{e.current().impulseJoints.contains(t.handle)&&e.current().removeImpulseJoint(t,n)},forEachCollider:t=>e.current().forEachCollider(t),setGravity:({x:t,y:n,z:r})=>e.current().gravity={x:t,y:n,z:r},debugRender:()=>e.current().debugRender()}),Zr=new bt;new yt;const $r=new U;new Hn;const ue=new Gn,Y=new U,ie=new bt,me=new U,Dt=e=>{const[t,n,r]=e;return new U(t,n,r)},Bt=({x:e,y:t,z:n,w:r})=>Zr.set(e,t,n,r),eo={fixed:1,dynamic:0,kinematicPosition:2,kinematicVelocity:3},un=e=>eo[e],to=(e,t)=>{const n=Array.from(e);for(let r=0;r<e.length/3;r++)n[r*3]*=t.x,n[r*3+1]*=t.y,n[r*3+2]*=t.z;return n},fn=e=>e?e instanceof bt?[e.x,e.y,e.z,e.w]:e instanceof U||e instanceof yt?[e.x,e.y,e.z]:Array.isArray(e)?e:[e]:[0];function pe(e){const t=u.useRef();return t.current===void 0&&(t.current={value:typeof e=="function"?e():e}),t.current.value}const no=e=>{const t=u.useRef(e),n=u.useRef(0),r=u.useRef(0);u.useEffect(()=>{t.current=e},[e]),u.useEffect(()=>{const s=()=>{const a=performance.now(),h=a-r.current;n.current=requestAnimationFrame(s),t.current(h/1e3),r.current=a};return n.current=requestAnimationFrame(s),()=>cancelAnimationFrame(n.current)},[])},ro=({onStep:e,updatePriority:t})=>(Je((n,r)=>{e(r)},t),null),oo=({onStep:e})=>(no(t=>{e(t)}),null),io=({onStep:e,type:t,updatePriority:n})=>t==="independent"?L.createElement(oo,{onStep:e}):L.createElement(ro,{onStep:e,updatePriority:n});var so=u.memo(io);function ao(e,t){if(e==null)return{};var n={},r=Object.keys(e),s,a;for(a=0;a<r.length;a++)s=r[a],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Mt(e,t){if(e==null)return{};var n=ao(e,t),r,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)r=a[s],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const lo=["mass","linearDamping","angularDamping","type","onCollisionEnter","onCollisionExit","onIntersectionEnter","onIntersectionExit","onContactForce","children","canSleep","ccd","gravityScale"],co=(e,t,n)=>{const r=t.slice();if(e==="heightfield"){const a=r[3];return a.x*=n.x,a.x*=n.y,a.x*=n.z,r}if(e==="trimesh"||e==="convexHull")return r[0]=to(r[0],n),r;const s=[n.x,n.y,n.z,n.x,n.x];return r.map((a,h)=>s[h]*a)},uo=(e,t,n,r)=>{const s=co(e.shape,e.args,n),a=cr[e.shape](...s);return t.createCollider(a,r==null?void 0:r())},Lt="Please pick ONLY ONE of the `density`, `mass` and `massProperties` options.",fo=(e,t)=>{if(t.density!==void 0){if(t.mass!==void 0||t.massProperties!==void 0)throw new Error(Lt);e.setDensity(t.density);return}if(t.mass!==void 0){if(t.massProperties!==void 0)throw new Error(Lt);e.setMass(t.mass);return}t.massProperties!==void 0&&e.setMassProperties(t.massProperties.mass,t.massProperties.centerOfMass,t.massProperties.principalAngularInertia,t.massProperties.angularInertiaLocalFrame)},dn={sensor:(e,t)=>{e.setSensor(t)},collisionGroups:(e,t)=>{e.setCollisionGroups(t)},solverGroups:(e,t)=>{e.setSolverGroups(t)},friction:(e,t)=>{e.setFriction(t)},frictionCombineRule:(e,t)=>{e.setFrictionCombineRule(t)},restitution:(e,t)=>{e.setRestitution(t)},restitutionCombineRule:(e,t)=>{e.setRestitutionCombineRule(t)},quaternion:()=>{},position:()=>{},rotation:()=>{},scale:()=>{}},pn=Object.keys(dn),po=(e,t,n)=>{const r=n.get(e.handle);if(r){var s;const a=r.object.parent.getWorldScale($r),h=(s=r.worldParent)===null||s===void 0?void 0:s.matrixWorld.clone().invert();r.object.updateWorldMatrix(!0,!1),ue.copy(r.object.matrixWorld),h&&ue.premultiply(h),ue.decompose(Y,ie,me),e.parent()?(e.setTranslationWrtParent({x:Y.x*a.x,y:Y.y*a.y,z:Y.z*a.z}),e.setRotationWrtParent(ie)):(e.setTranslation({x:Y.x*a.x,y:Y.y*a.y,z:Y.z*a.z}),e.setRotation(ie)),pn.forEach(f=>{if(f in t){const l=t[f];dn[f](e,l,t)}}),fo(e,t)}},mo=(e,t,n)=>{const r=u.useMemo(()=>pn.flatMap(s=>fn(t[s])),[t]);u.useEffect(()=>{const s=e();po(s,t,n)},r)},vo=e=>{let t=!1;return e.traverseAncestors(n=>{n.userData.r3RapierType==="MeshCollider"&&(t=!0)}),t},ho=(e,t,n)=>({collider:e,worldParent:n||void 0,object:t}),go={cuboid:"cuboid",ball:"ball",hull:"convexHull",trimesh:"trimesh"},yo=({object:e,ignoreMeshColliders:t=!0,options:n})=>{const r=[];e.updateWorldMatrix(!0,!1);const s=e.matrixWorld.clone().invert(),a=h=>{if("isMesh"in h){if(t&&vo(h))return;const f=h.getWorldScale(me),l=go[n.colliders||"cuboid"];h.updateWorldMatrix(!0,!1),ue.copy(h.matrixWorld).premultiply(s).decompose(Y,ie,me);const g=new yt().setFromQuaternion(ie,"XYZ"),{geometry:i}=h,{args:o,offset:d}=bo(i,n.colliders||"cuboid"),m=N(N({},vn(n)),{},{args:o,shape:l,rotation:[g.x,g.y,g.z],position:[Y.x+d.x*f.x,Y.y+d.y*f.y,Y.z+d.z*f.z],scale:[f.x,f.y,f.z]});r.push(m)}};return n.includeInvisible?e.traverse(a):e.traverseVisible(a),r},bo=(e,t)=>{switch(t){case"cuboid":{e.computeBoundingBox();const{boundingBox:r}=e,s=r.getSize(new U);return{args:[s.x/2,s.y/2,s.z/2],offset:r.getCenter(new U)}}case"ball":{e.computeBoundingSphere();const{boundingSphere:r}=e;return{args:[r.radius],offset:r.center}}case"trimesh":{var n;const r=e.index?e.clone():Yr(e);return{args:[r.attributes.position.array,(n=r.index)===null||n===void 0?void 0:n.array],offset:new U}}case"hull":return{args:[e.clone().attributes.position.array],offset:new U}}return{args:[],offset:new U}},mn=e=>({collision:!!(e!=null&&e.onCollisionEnter||e!=null&&e.onCollisionExit||e!=null&&e.onIntersectionEnter||e!=null&&e.onIntersectionExit),contactForce:!!(e!=null&&e.onContactForce)}),Eo=(e,t,n,r={})=>{const{onCollisionEnter:s,onCollisionExit:a,onIntersectionEnter:h,onIntersectionExit:f,onContactForce:l}=t;u.useEffect(()=>{const g=e();if(g){const{collision:i,contactForce:o}=mn(t),d=i||r.collision,m=o||r.contactForce;d&&m?g.setActiveEvents(Ge.COLLISION_EVENTS|Ge.CONTACT_FORCE_EVENTS):d?g.setActiveEvents(Ge.COLLISION_EVENTS):m&&g.setActiveEvents(Ge.CONTACT_FORCE_EVENTS),n.set(g.handle,{onCollisionEnter:s,onCollisionExit:a,onIntersectionEnter:h,onIntersectionExit:f,onContactForce:l})}return()=>{g&&n.delete(g.handle)}},[s,a,h,f,l,r])},vn=(e={})=>Mt(e,lo),Ke=()=>u.useContext(hn),xt=(e,t,n=!0)=>{const[r,s]=u.useState([]);return u.useEffect(()=>{e.current&&t.colliders!==!1&&s(yo({object:e.current,options:t,ignoreMeshColliders:n}))},[t.colliders]),r},wo=u.memo(()=>{const{world:e}=Ke(),t=u.useRef(null);return Je(()=>{const n=t.current;if(!n)return;const r=e.debugRender();n.geometry.setAttribute("position",new Xe(r.vertices,3)),n.geometry.setAttribute("color",new Xe(r.colors,4))}),L.createElement("group",null,L.createElement("lineSegments",{ref:t,frustumCulled:!1},L.createElement("lineBasicMaterial",{color:16777215,vertexColors:!0}),L.createElement("bufferGeometry",null)))}),hn=u.createContext(void 0),Qe=(e,t)=>{var n,r,s,a,h,f;return{target:{rigidBody:e.rigidBody.object,collider:e.collider.object,colliderObject:(n=e.collider.state)===null||n===void 0?void 0:n.object,rigidBodyObject:(r=e.rigidBody.state)===null||r===void 0?void 0:r.object},other:{rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:(s=t.collider.state)===null||s===void 0?void 0:s.object,rigidBodyObject:(a=t.rigidBody.state)===null||a===void 0?void 0:a.object},rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:(h=t.collider.state)===null||h===void 0?void 0:h.object,rigidBodyObject:(f=t.rigidBody.state)===null||f===void 0?void 0:f.object}},Co=async()=>{let e=await Xr(()=>import("./@dimforge-dee4de67.js"),[]);return await e.init(),e},mi=({colliders:e="cuboid",gravity:t=[0,-9.81,0],children:n,timeStep:r=1/60,paused:s=!1,interpolate:a=!0,updatePriority:h,updateLoop:f="follow",debug:l=!1})=>{const g=dr(Co),{invalidate:i}=se(),o=u.useRef(),d=u.useRef(()=>{if(!o.current){const A=new g.World(Dt(t));o.current=A}return o.current}),m=pe(()=>new Map),v=pe(()=>new Map),E=pe(()=>new Map),y=pe(()=>new Map),c=pe(()=>new fr(!1)),p=pe(()=>new Set),b=pe(()=>new Set);u.useEffect(()=>{const A=d.current();return()=>{A&&(A.free(),o.current=void 0)}},[]),u.useEffect(()=>{const A=o.current;A&&(A.gravity=Dt(t))},[t]);const S=u.useMemo(()=>Kr(d),[]),_=u.useCallback(A=>{const w=o.current;if(w){var T;const H=w.getCollider(A),K=y.get(A),G=v.get(A),R=H==null||(T=H.parent())===null||T===void 0?void 0:T.handle,I=R!==void 0?w.getRigidBody(R):void 0,M=I&&R!==void 0?E.get(R):void 0,C=R!==void 0?m.get(R):void 0;return{collider:{object:H,events:K,state:G},rigidBody:{object:I,events:M,state:C}}}},[]),[P]=u.useState({previousState:{},accumulator:0}),F=u.useCallback(A=>{const w=o.current;if(!w)return;const T=r==="vary",H=xe.clamp(A,0,.2),K=()=>{p.forEach(R=>{R.current(S)}),w.step(c),b.forEach(R=>{R.current(S)})};if(T)w.timestep=H,K();else for(w.timestep=r,P.accumulator+=H;P.accumulator>=r;)a&&(P.previousState={},w.forEachRigidBody(R=>{P.previousState[R.handle]={position:R.translation(),rotation:R.rotation()}})),K(),P.accumulator-=r;const G=T||!a||s?1:P.accumulator/r;m.forEach((R,I)=>{const M=w.getRigidBody(I),C=E.get(I);if(C!=null&&C.onSleep||C!=null&&C.onWake){if(M.isSleeping()&&!R.isSleeping){var x;C==null||(x=C.onSleep)===null||x===void 0||x.call(C)}if(!M.isSleeping()&&R.isSleeping){var O;C==null||(O=C.onWake)===null||O===void 0||O.call(C)}R.isSleeping=M.isSleeping()}if(!M||M.isSleeping()&&!("isInstancedMesh"in R.object)||!R.setMatrix)return;let j=M.translation(),z=M.rotation(),D=P.previousState[I];D&&(ue.compose(D.position,Bt(D.rotation),R.scale).premultiply(R.invertedWorldMatrix).decompose(Y,ie,me),R.meshType=="mesh"&&(R.object.position.copy(Y),R.object.quaternion.copy(ie))),ue.compose(j,Bt(z),R.scale).premultiply(R.invertedWorldMatrix).decompose(Y,ie,me),R.meshType=="instancedMesh"?R.setMatrix(ue):(R.object.position.lerp(Y,G),R.object.quaternion.slerp(ie,G))}),c.drainCollisionEvents((R,I,M)=>{const C=_(R),x=_(I);if(!(C!=null&&C.collider.object)||!(x!=null&&x.collider.object))return;const O=Qe(C,x),j=Qe(x,C);if(M)w.contactPair(C.collider.object,x.collider.object,(ne,Be)=>{var Le,Ze,ze,$e,We,et,Ne,tt;(Le=C.rigidBody.events)===null||Le===void 0||(Ze=Le.onCollisionEnter)===null||Ze===void 0||Ze.call(Le,N(N({},O),{},{manifold:ne,flipped:Be})),(ze=x.rigidBody.events)===null||ze===void 0||($e=ze.onCollisionEnter)===null||$e===void 0||$e.call(ze,N(N({},j),{},{manifold:ne,flipped:Be})),(We=C.collider.events)===null||We===void 0||(et=We.onCollisionEnter)===null||et===void 0||et.call(We,N(N({},O),{},{manifold:ne,flipped:Be})),(Ne=x.collider.events)===null||Ne===void 0||(tt=Ne.onCollisionEnter)===null||tt===void 0||tt.call(Ne,N(N({},j),{},{manifold:ne,flipped:Be}))});else{var z,D,Q,q,Z,ee,de,X;(z=C.rigidBody.events)===null||z===void 0||(D=z.onCollisionExit)===null||D===void 0||D.call(z,O),(Q=x.rigidBody.events)===null||Q===void 0||(q=Q.onCollisionExit)===null||q===void 0||q.call(Q,j),(Z=C.collider.events)===null||Z===void 0||(ee=Z.onCollisionExit)===null||ee===void 0||ee.call(Z,O),(de=x.collider.events)===null||de===void 0||(X=de.onCollisionExit)===null||X===void 0||X.call(de,j)}if(M){if(w.intersectionPair(C.collider.object,x.collider.object)){var W,oe,$,ae,le,Re,te,ve;(W=C.rigidBody.events)===null||W===void 0||(oe=W.onIntersectionEnter)===null||oe===void 0||oe.call(W,O),($=x.rigidBody.events)===null||$===void 0||(ae=$.onIntersectionEnter)===null||ae===void 0||ae.call($,j),(le=C.collider.events)===null||le===void 0||(Re=le.onIntersectionEnter)===null||Re===void 0||Re.call(le,O),(te=x.collider.events)===null||te===void 0||(ve=te.onIntersectionEnter)===null||ve===void 0||ve.call(te,j)}}else{var ce,he,ge,_e,ye,Oe,be,je;(ce=C.rigidBody.events)===null||ce===void 0||(he=ce.onIntersectionExit)===null||he===void 0||he.call(ce,O),(ge=x.rigidBody.events)===null||ge===void 0||(_e=ge.onIntersectionExit)===null||_e===void 0||_e.call(ge,j),(ye=C.collider.events)===null||ye===void 0||(Oe=ye.onIntersectionExit)===null||Oe===void 0||Oe.call(ye,O),(be=x.collider.events)===null||be===void 0||(je=be.onIntersectionExit)===null||je===void 0||je.call(be,j)}}),c.drainContactForceEvents(R=>{var I,M,C,x,O,j,z,D;const Q=_(R.collider1()),q=_(R.collider2());if(!(Q!=null&&Q.collider.object)||!(q!=null&&q.collider.object))return;const Z=Qe(Q,q),ee=Qe(q,Q);(I=Q.rigidBody.events)===null||I===void 0||(M=I.onContactForce)===null||M===void 0||M.call(I,N(N({},Z),{},{totalForce:R.totalForce(),totalForceMagnitude:R.totalForceMagnitude(),maxForceDirection:R.maxForceDirection(),maxForceMagnitude:R.maxForceMagnitude()})),(C=q.rigidBody.events)===null||C===void 0||(x=C.onContactForce)===null||x===void 0||x.call(C,N(N({},ee),{},{totalForce:R.totalForce(),totalForceMagnitude:R.totalForceMagnitude(),maxForceDirection:R.maxForceDirection(),maxForceMagnitude:R.maxForceMagnitude()})),(O=Q.collider.events)===null||O===void 0||(j=O.onContactForce)===null||j===void 0||j.call(O,N(N({},Z),{},{totalForce:R.totalForce(),totalForceMagnitude:R.totalForceMagnitude(),maxForceDirection:R.maxForceDirection(),maxForceMagnitude:R.maxForceMagnitude()})),(z=q.collider.events)===null||z===void 0||(D=z.onContactForce)===null||D===void 0||D.call(z,N(N({},ee),{},{totalForce:R.totalForce(),totalForceMagnitude:R.totalForceMagnitude(),maxForceDirection:R.maxForceDirection(),maxForceMagnitude:R.maxForceMagnitude()}))}),w.forEachActiveRigidBody(()=>{i()})},[s,r,a]),B=u.useMemo(()=>({rapier:g,world:S,physicsOptions:{colliders:e,gravity:t},rigidBodyStates:m,colliderStates:v,rigidBodyEvents:E,colliderEvents:y,beforeStepCallbacks:p,afterStepCallbacks:b,isPaused:s,isDebug:l,step:F}),[s,F,l,e,t]),k=u.useCallback(A=>{s||F(A)},[s,F]);return L.createElement(hn.Provider,{value:B},L.createElement(so,{onStep:k,type:f,updatePriority:h}),l&&L.createElement(wo,null),n)};function J(){return J=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},J.apply(this,arguments)}const gn=(e,t)=>{const n=u.useRef(),r=u.useMemo(()=>()=>(n.current||(n.current=e()),n.current),[]);return u.useEffect(()=>{const s=r();return()=>{t(s),n.current=void 0}},[]),r},Mo=({x:e,y:t,z:n}={x:0,y:0,z:0})=>new U(e,t,n),re=u.memo(u.forwardRef((e,t)=>{const{children:n,position:r,rotation:s,quaternion:a,scale:h,name:f}=e,{world:l,colliderEvents:g,colliderStates:i}=Ke(),o=wn(),d=u.useRef(null),m=gn(()=>{const E=d.current.getWorldScale(Mo());return uo(e,l,E,o==null?void 0:o.getRigidBody)},E=>{l.removeCollider(E)});u.useEffect(()=>{const E=m();return i.set(E.handle,ho(E,d.current,o==null?void 0:o.ref.current)),()=>{i.delete(E.handle)}},[]),u.useImperativeHandle(t,()=>m());const v=u.useMemo(()=>N(N({},vn(o==null?void 0:o.options)),e),[e,o==null?void 0:o.options]);return mo(m,v,i),Eo(m,v,g,mn(o==null?void 0:o.options)),L.createElement("object3D",{position:r,rotation:s,quaternion:a,scale:h,ref:d,name:f},n)})),xo=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"cuboid",ref:t}))),Po=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"roundCuboid",ref:t}))),So=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"ball",ref:t}))),Ro=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"capsule",ref:t}))),_o=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"heightfield",ref:t}))),Oo=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"trimesh",ref:t}))),jo=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"cone",ref:t}))),Ao=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"cylinder",ref:t}))),Fo=L.forwardRef((e,t)=>L.createElement(re,J({},e,{shape:"convexHull",ref:t})));xo.displayName="CuboidCollider";Po.displayName="RoundCuboidCollider";So.displayName="BallCollider";Ro.displayName="CapsuleCollider";_o.displayName="HeightfieldCollider";Oo.displayName="TrimeshCollider";jo.displayName="ConeCollider";Ao.displayName="CylinderCollider";Fo.displayName="ConvexHullCollider";const To=e=>{var t;const n=un((e==null?void 0:e.type)||"dynamic"),r=new ur(n);return r.canSleep=(t=e==null?void 0:e.canSleep)!==null&&t!==void 0?t:!0,r},ko=({rigidBody:e,object:t,setMatrix:n,getMatrix:r,worldScale:s,meshType:a="mesh"})=>{t.updateWorldMatrix(!0,!1);const h=t.parent.matrixWorld.clone().invert();return{object:t,rigidBody:e,invertedWorldMatrix:h,setMatrix:n||(f=>{t.matrix.copy(f)}),getMatrix:r||(f=>f.copy(t.matrix)),scale:s||t.getWorldScale(me).clone(),isSleeping:!1,meshType:a}},yn={gravityScale:(e,t)=>{e.setGravityScale(t,!0)},linearDamping:(e,t)=>{e.setLinearDamping(t)},angularDamping:(e,t)=>{e.setAngularDamping(t)},dominanceGroup:(e,t)=>{e.setDominanceGroup(t)},enabledRotations:(e,[t,n,r])=>{e.setEnabledRotations(t,n,r,!0)},enabledTranslations:(e,[t,n,r])=>{e.setEnabledTranslations(t,n,r,!0)},lockRotations:(e,t)=>{e.lockRotations(t,!0)},lockTranslations:(e,t)=>{e.lockTranslations(t,!0)},angularVelocity:(e,[t,n,r])=>{e.setAngvel({x:t,y:n,z:r},!0)},linearVelocity:(e,[t,n,r])=>{e.setLinvel({x:t,y:n,z:r},!0)},ccd:(e,t)=>{e.enableCcd(t)},userData:(e,t)=>{e.userData=t},type(e,t){e.setBodyType(un(t),!0)},position:()=>{},rotation:()=>{},quaternion:()=>{},scale:()=>{}},bn=Object.keys(yn),Io=(e,t,n,r=!0)=>{if(!e)return;const s=n.get(e.handle);s&&(r&&(s.object.updateWorldMatrix(!0,!1),ue.copy(s.object.matrixWorld).decompose(Y,ie,me),e.setTranslation(Y,!1),e.setRotation(ie,!1)),bn.forEach(a=>{a in t&&yn[a](e,t[a])}))},Do=(e,t,n,r=!0)=>{const s=u.useMemo(()=>bn.flatMap(a=>fn(t[a])),[t]);u.useEffect(()=>{const a=e();Io(a,t,n,r)},s)},Bo=(e,t,n)=>{const{onWake:r,onSleep:s,onCollisionEnter:a,onCollisionExit:h,onIntersectionEnter:f,onIntersectionExit:l,onContactForce:g}=t,i={onWake:r,onSleep:s,onCollisionEnter:a,onCollisionExit:h,onIntersectionEnter:f,onIntersectionExit:l,onContactForce:g};u.useEffect(()=>{const o=e();return n.set(o.handle,i),()=>{n.delete(o.handle)}},[r,s,a,h,f,l,g])},Lo=["children","type","position","rotation","scale","quaternion","transformState"],En=u.createContext(void 0),wn=()=>u.useContext(En),Cn=u.memo(u.forwardRef((e,t)=>{const{children:n,type:r,position:s,rotation:a,scale:h,quaternion:f,transformState:l}=e,g=Mt(e,Lo),i=u.useRef(null),{world:o,rigidBodyStates:d,physicsOptions:m,rigidBodyEvents:v}=Ke(),E=u.useMemo(()=>N(N(N({},m),e),{},{children:void 0}),[m,e]),y=xt(i,E),c=gn(()=>{const b=To(E);return o.createRigidBody(b)},b=>{o.removeRigidBody(b)});u.useEffect(()=>{const b=c(),S=ko({rigidBody:b,object:i.current});return d.set(b.handle,e.transformState?e.transformState(S):S),()=>{d.delete(b.handle)}},[]),Do(c,E,d),Bo(c,E,v),u.useImperativeHandle(t,()=>c());const p=u.useMemo(()=>({ref:i,getRigidBody:c,options:E}),[E]);return L.createElement(En.Provider,{value:p},L.createElement("object3D",J({ref:i},g,{position:s,rotation:a,quaternion:f,scale:h}),n,y.map((b,S)=>L.createElement(re,J({key:S},b)))))}));Cn.displayName="RigidBody";const zo=u.memo(e=>{const{children:t,type:n}=e,{physicsOptions:r}=Ke(),s=u.useRef(null),{options:a}=wn(),h=u.useMemo(()=>N(N(N({},r),a),{},{children:void 0,colliders:n}),[r,a]),f=xt(s,h,!1);return L.createElement("object3D",{ref:s,userData:{r3RapierType:"MeshCollider"}},t,f.map((l,g)=>L.createElement(re,J({key:g},l))))});zo.displayName="MeshCollider";const Wo=["children","instances","colliderNodes","position","rotation","quaternion","scale"],No=u.memo(u.forwardRef((e,t)=>{const n=u.useRef(null),r=u.useRef(null),{children:s,instances:a,colliderNodes:h=[],position:f,rotation:l,quaternion:g,scale:i}=e,o=Mt(e,Wo),d=u.useRef([]);u.useImperativeHandle(t,()=>d.current,[a]);const m=xt(n,N(N({},e),{},{children:void 0})),v=()=>{const y=r.current.children[0];if(y&&"isInstancedMesh"in y)return y};u.useEffect(()=>{const y=v();y?y.instanceMatrix.setUsage(qn):console.warn("InstancedRigidBodies expects exactly one child, which must be an InstancedMesh")},[]);const E=(y,c)=>{const p=v();return p?N(N({},y),{},{getMatrix:b=>(p.getMatrixAt(c,b),b),setMatrix:b=>{p.setMatrixAt(c,b),p.instanceMatrix.needsUpdate=!0},meshType:"instancedMesh"}):y};return L.createElement("object3D",J({ref:n},o,{position:f,rotation:l,quaternion:g,scale:i}),L.createElement("object3D",{ref:r},s),a==null?void 0:a.map((y,c)=>L.createElement(Cn,J({},o,y,{ref:p=>d.current[c]=p,transformState:p=>E(p,c)}),L.createElement(L.Fragment,null,h.map((p,b)=>L.createElement(u.Fragment,{key:b},p)),m.map((p,b)=>L.createElement(re,J({key:b},p)))))))}));No.displayName="InstancedRigidBodies";export{si as C,di as F,ai as H,ci as P,ui as Q,Cn as R,fi as T,ii as a,Ee as b,li as c,pi as d,Je as e,mi as f,xo as g,se as h,cn as u};
